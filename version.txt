import requests, os

REMOTE_VERSION_URL = "https://raw.githubusercontent.com/Cjcjufl/pulse-update/main/version.txt"
REMOTE_FILE_URL    = "https://github.com/Cjcjufl/pulse-update/raw/main/pulse_v1.0.0.zip"
LOCAL_VERSION_FILE = "version.txt"  # 本地记录当前版本

def get_remote_version():
    r = requests.get(REMOTE_VERSION_URL, timeout=8)
    r.raise_for_status()
    return r.text.strip()

def get_local_version():
    return open(LOCAL_VERSION_FILE,"r").read().strip() if os.path.exists(LOCAL_VERSION_FILE) else "0.0.0"

def download(url, dst):
    with requests.get(url, stream=True, timeout=30) as r:
        r.raise_for_status()
        with open(dst,"wb") as f:
            for chunk in r.iter_content(1024*64):
                if chunk: f.write(chunk)

def main():
    local = get_local_version()
    remote = get_remote_version()
    if local != remote:
        print(f"有新版本：{remote}（本地：{local}）→ 开始下载…")
        download(REMOTE_FILE_URL, f"pulse_v{remote}.zip")
        open(LOCAL_VERSION_FILE,"w").write(remote)
        print("更新包下载完成，并已记录新版本。")
    else:
        print("已经是最新版本。")

if __name__ == "__main__":
    main()
